# Context Free Grammars

Reference: https://www.tutorialspoint.com/automata_theory/context_free_grammar_introduction.htm

A language is context free when no prior knowledge (context) is required to understand it. You can simply apply the production rules in order to find the sentences that are valid in the language.

## BNF

We can define context free grammars using *Backus-Naur form* (BNF)

![Screenshot 2018-10-31 at 18.59.51](/Users/jackcorbett/Documents/University/Theory of Computing/Part 1/Images/BNF Context Free Grammar.png)

> Above is an example of a context free gramar because it consits of a **finite set of rules** of well-formed expressions in some language

<xxx> are the **nonterminal symbols** - each geneartes a set of strings over a finite alphabet $\Sigma$ in a systematic way

​	eg: <var> tells us that a variable can be any lower case letter of the alphabet

We can also describe nonterminal symbols in terms of other nonterminal symbols eg: <arith-expr>

> We can replace nonterminal symbols by applying the corresponding rule. By repeating this we can derive a string of terminal symbols. The intermediary steps are called *sentential forms*
>
> The set of all strings **not** containing any **nonterminals** generated by the grammar is called the **language** generated by the grammar.

## Definition

A CFG is a quadruple:

$G = (N, \Sigma, P, S)$

- $N$ is a finite set of **nonterminal symbols** (*variables*)
- $\Sigma $ is a finite set of **terminal symbols** (*alphabet*)
- $P \sube N \times (N + \Sigma)^*$ are the **productions**
- $S \in N$ is the **start symbol**

### Syntax

- Capital letters represent nonterminals and lower case represent terminals
- Strings in $(N + \Sigma)^*$ are denoted by greek letters eg: $\alpha, \ \beta, \ \gamma $
- Instead of writing productions in the form $(A, \alpha) \in P$ we use $A \rightarrow \alpha$
- We use | to abbreviate a set of productions with the same left-hand side
  - $A \rightarrow \alpha_1 | \alpha_2 | ... | \alpha_k$ for $A \rightarrow \alpha_1, A \rightarrow \alpha_2, ..., A \rightarrow \alpha_k$

### Derivations

For a CFG $G$, define relations $\overset{k}{\implies}$ on $\alpha, \beta \in(N + \Sigma)^*$ as follows:

- $\alpha \overset{0}{\implies} \alpha$
- If $\alpha \overset{k}{\implies} \beta, \quad \beta = \beta_1A\beta_2$ and $A \rightarrow \gamma$ then $\alpha \overset{k+1}{\implies} \beta_1 \gamma \beta_2$ 

Write $\alpha \implies \beta$ if $\alpha \overset{k}{\implies} \beta$ for some $k$

- If $\alpha \implies \beta$ we say that $\beta$ is **deliverable** from $\alpha$
- If $S \implies \alpha$ then $\alpha$ is a **sentential form**
- If $S \implies x (x \in \Sigma^*)$ (*only contains terminal symbols*) then $x$ is called a **sentence**

> If no $k$ is present it means we don't know how many times we will have to apply the production rules as $k$ is the **number of production rules applied (steps)**

## Language

The language generated by a CFG $G$ is the set of all its **sentences** (set of all strings containing only **terminal symbols**)

> $L(G) = \{x \in \Sigma^* \space | \space S \implies x\}\quad$  *we can derive x from S*

A language is called **context free** (*CFL*) when it is $L(G)$ for some CFG $G$ 

## Example

$\{a^nb^n | n \in N\}$ is a **CFL** 

- It is generated by the grammar $S \rightarrow aSb \space | \space \epsilon$
- Formally:

$$
G = (\{S\}, \{a,b\},\{(S,aSb),(S,\epsilon)\},S)
$$

Example derivation:
$$
S \overset{1}{\implies} aSb \overset{1}{\implies} aaSbb \overset{1}{\implies} aabb \\
so \\
S \overset{3}{\implies} aabb
$$

### Proof

Claim $L(G) = \{a^nb^n | n \in N\}$ 

By induction on $k$, for all $k$ we have $S \overset{k}{\implies} a^kSb^k$

- **Base case** for $k = 0, S \overset{0}{\implies} S$
- **Inductive step** assume that $S \overset{k}{\implies} a^kSb^k$ then $a^kSb^k \implies a^kaSbb^k = a^{k+1}Sb^{k+1}$ so $S \overset{k+1}{\implies} a^{k+1}Sb^{k+1}$

But $S \implies \epsilon$ so for all $k, S \overset{k+1}{\implies} a^kb^k$ hence $\{a^nb^n | n \in N\} \sube L(G)$ 

By induction on $k$, if $S \overset{k+1}{\implies} x$ then $x = a^kb^k$ 

> So $L(G) \sube \{a^nb^n \space | \space b \in N\}$
>

### Another Example

Given $L(G)$ is the set of all palindromes over the alphabet $\Sigma = \{a, b\}$

We can define a CFL with the production rules ($P$):
$$
S \rightarrow aSa \ | \ bSb \ | \ \epsilon \ | \ a \ | \ b
$$

*The a and b are required for palindromes with a central a and b*

## Normal Forms

A CFG is in **chomsky normal form** (*CNF*) when all productions are of the form
$$
A \rightarrow BC \quad or \quad A \rightarrow a \quad (A, B, C \in N, a \in \Sigma)
$$
`Right side is either terminal or nonterminal NOT both`

A CFG is in **greibach normal form** (*GNF*) when all productions are of the form
$$
A \rightarrow aB_1B_2...B_k \quad (k \geq 0, A, B_1,...,B_k \in N, a \in \Sigma)
$$

`Terminal symbol followed by chain of nonterminals`

> No grammar in *CNF* or *GNF* can generate the empty string $\epsilon$

### Examples

$\{a^nb^n | n > 0\}$

A grammar in **CNF**
$$
S \rightarrow AT \ | \ AB, \quad T \rightarrow SB, \quad A \rightarrow a, \quad B \rightarrow b
$$
A grammar in **GNF**
$$
S \rightarrow aSB \ | \ aB, \quad B \rightarrow b
$$



The set of all nonnull strings of balanced parentheses [ ]

A grammar in **CNF**
$$
S \rightarrow AB \ | \ AC \ | \ SS, \quad C \rightarrow SB, \quad A \rightarrow [ \, \quad B \rightarrow \ ]
$$
A grammar in **GNF**
$$
S \rightarrow [B \ | \ [SB \ | \ [BS \ | \ [SBS, \quad B \rightarrow \ ]
$$


## Removing $\epsilon$- and Unit Productions

A production $A \rightarrow \epsilon$ is called an **$\epsilon$-production**

A production $A \rightarrow B​$ is called **unit-production** (nonterminal to nonterminal)

> Lemma: For CFG $G = (N, \Sigma, P, S)$ there exists CFG $G'$ with no $\epsilon$- or unit productions

## Proof of Lemma

Let $\hat{P}$ be the smallest set of productions containing P such that:

- If $A \rightarrow \alpha B \beta$ & $B \rightarrow \epsilon \in \hat{P}$ then $A \rightarrow \alpha \beta \in \hat{P}$ 		*as B will just be replaced with nothing*
- If $A \rightarrow B$ & $B \rightarrow \gamma \in \hat{P}$ then $A \rightarrow \gamma \in \hat{P}$  			*as the nonterminal symbol B isn't needed*



If $\hat{G} = (N, \Sigma, \hat{P}, S)$

### Claim

Let $x \neq \epsilon \in \Sigma ^*$ and let $S \overset{k}{\implies} x$ be a **shortest** derivation of $x$. Then no $\epsilon$-productions or unit productions have been used.

### Proof 1

Suppose that an $\epsilon$ production $B \rightarrow \epsilon$ has been used:
$$
S \overset{k_1}{\implies} \gamma B \delta \overset{1}{\implies} \gamma \delta \overset{k_2}{\implies} x \quad \quad \quad \quad \quad \quad (k_1 + k_2 + 1 = k) \\
S \overset{l_1}{\implies} \eta A \theta \overset{1}{\implies} \eta \alpha B \beta \theta \overset{l_2}{\implies} \gamma B \delta \overset{1}{\implies} \gamma \delta \overset{k_2}{\implies} x \quad \quad (l_1 + l_2 + 1 = k_1, A \rightarrow \alpha B \beta \in \hat{P}) \\
S \overset{l_1}{\implies} \eta A \theta \overset{1}{\implies} \eta \alpha \beta \theta \overset{l_1}{\implies} \gamma \delta \overset{k_2}{\implies} x \quad \quad \ (since \ A \rightarrow \alpha \beta \in \hat{P})
$$

### Proof 2

Suppose that a unit production $A \rightarrow B​$ is used:
$$
S \overset{k_1}{\implies} \alpha A \beta \overset{1}{\implies} \alpha B \beta \overset{k_2}{\implies} x \quad \quad \quad \quad \quad (k_1 + k_2 + 1 = k) \\
S \overset{k_1}{\implies} \alpha A \beta \overset{1}{\implies} \alpha B \beta \overset{l_1}{\implies} \eta B \theta \overset{1}{\implies} \eta \gamma \theta \overset{l_2}{\implies} x \quad (l_1 + l_2 + 1 = k_2, B \rightarrow \gamma \in \hat{P}) \\
S \overset{k_1}{\implies} \alpha A \beta \overset{1}{\implies} \alpha \gamma \beta \overset{l_1}{\implies} \eta \gamma \theta \overset{l_2}{\implies} x \quad \ \ (simce \ A \rightarrow \gamma \in \hat{P})
$$
> Both last derivations are one step shorter, this is a contradition and we therefore do not need $\epsilon$-productions or unit productions to generate nonnull strings

### Proof 3

- If $\hat{G} = (N, \Sigma, \hat{P}, S)$
  - Since $P \sube \hat{P}$ we have $L(G) \sube L(\hat{G})$ 
  - But extra productions in $\hat{P}$ are obtained by two applications of productions in $P$, so $L(\hat{G}) \sube L(G)$
- So for any $x \neq \epsilon$, if $S \implies x$ in $\hat{G}$ then there exists a shorter derivation that doesn't use either $\epsilon$- nor unit productions.

- Obtain $G'$ by removing the $\epsilon$ and unit productions from $\hat{P}$:

$$
L(G) - \{\epsilon\} = L(\hat{G}) - \{\epsilon\} = L(G')
$$

## Normal Form Theorem

> For any CFG $G$ there exists a CFG $G'$ in Chombsky normal form and a CFG $G''$ in Greibach normal form such that
> $$
> L(G'') = L(G') = L(G) - \{\epsilon\}
> $$
>

For CNF we already did the hard work by showing how to remove $\epsilon$- and unit productions...

Converting to GNF is harder

## Converting to CNF (Chomsky Normal Form)

1. Remove the $\epsilon$- and unit productions by following the process above
2. For all $\sigma \in \Sigma$ add new nonterminal $N_\sigma$ to $N$
3. Replace any terminal $a$ in any production in $P$ with $N_\sigma$ 
4. Add productions $N_\sigma \rightarrow \sigma​$ to $P​$
5. While there exists a production $A \rightarrow B_1 B_2...B_k$ with $k > 2$
   1. Remove the production from $P$
   2. Add new nonterminal $C$ to $N$
   3. Add productions $A \rightarrow B_1C, C \rightarrow B_2...B_k$ to $N$