# CFL Closure Properties

In the following examples $G_1 = (N_1, \Sigma, P_1, S_1)$ and $G_2 = (N_2, \Sigma, P_2, S_2)$ are CFGs, with $N_1 \cap N_2 = \empty$

## Union

CFLs **are** closed under **union** so $G_3​$

- $N_3 \overset{def}{=} N_1 \cup N_2 \cup \{S_3\}$ where $S_3 \notin N_1 \cup N_2$
- $P_3 \overset{def}{=} P_1 \cup P_2 \cup \{S_3 \rightarrow S_1, S_3 \rightarrow S_2\}$ where $S_3 \notin N_1 \cup N_2$

- Start nonterminal: $S_3$

$L(G_3) = L(G_1) \cup L(G_2)$

> We effectively merge the languanges by adding a production rule from the new start nonterminal $S_3$ to the starting nonterminals of $G_1$ and $G_2​$

## Concatenation

CFLs **are** closed under **concatentation** so $G_3$

- $N_3 \overset{def}{=} N_1 \cup N_2 \cup \{S_3\}$ where $S_3 \notin N_1 \cup N_2$
- $P_3 \overset{def}{=} P_1 \cup P_2 \cup \{S_3 \rightarrow S_1 S_2\}$

- Start nonterminal: $S_3$

$L(G_3) = L(G_1)L(G_2)$

> The same idea as union except we define one production rule from $S_3$ as the concatenation of $S_1 S_2$

## Kleene Star

CFLs **are** closed under **Kleene Star**

If $G_1 = (N_1, \Sigma, P_1, S_1)$ then let $G_2$ consist of

- $N_2 \overset{def}{=} N_1 \cup \{S_2\}$, where $S_2 \notin N_1$
- $P_2 \overset{def}{=} P_1 \cup \{S_2 \rightarrow S_1S_2, S_2 \rightarrow \epsilon\}$
- Start nonterminal: $S_2$

$L(G_2) = L(G_1)^*$

## Intersection with Regular Language

CFLs are closed under intersection with regular languages

The idea is: Product construction with PDA and a DFA. We can't achieve this 



# Limits of CFGs

## CFGs and CFLs

We know that the context free languages are those:

- Generated by CFGs
- Accepted by PDAs

All regular languages are context free but not **all** languages are context free

## Long Derivations

Given a CNF grammar for $\{a^nb^n \ | \ n \geq 0\}$ in **Chomsky normal form**:
$$
S \rightarrow AC \ | \ AB, \quad C \rightarrow SB \\ A \rightarrow a, \quad B \rightarrow b
$$
Consider the derivation of $a^3b^3$ represented as a binary tree

![Screenshot 2018-11-01 at 10.11.44](/Users/jackcorbett/Documents/University/Theory of Computing/Part 1/Images/a3b3 Derivation Tree.png)

> This shows any derivation of a long string has to have a long path of nonterminals in the derivation graph

![Screenshot 2018-11-01 at 10.14.21](/Users/jackcorbett/Documents/University/Theory of Computing/Part 1/Images/Long Derivation.png)

- Our grammar is in CNF
- Going down one step in the tree **at most** doubles it's width (as it's a binary tree)

So the derivation graph of a string of size $2^k$ must have depth of at least $k$ 

> Suppose that there are $n$ nonterminals. In any derivation graph of a string of length at least $2^{n+1}$ there must be a path where some **nonterminal** appears at least **twice**
>
> Above we can see $S$ appears twice marked in red and blue

### Pumping Strings

![Screenshot 2018-11-01 at 10.20.08](/Users/jackcorbett/Documents/University/Theory of Computing/Part 1/Images/Pumping Strings.png)

Where we have the same nonterminals on the path we can **pump**

This means we can copy the subtree at the first $S$ and paste it at the second

![Screenshot 2018-11-01 at 10.22.04](/Users/jackcorbett/Documents/University/Theory of Computing/Part 1/Images/Pumping Strings 2.png)

We could also replace the subtree at the first $S$ with the subtree at the second

## Pumping Lemma for CFLs

For any CFL $A$, there exists $k \geq 0$ such that every $z \in A$ of size at least $k$ can be broken up into five substrings $z = uvwxy$ such that $vx \neq \epsilon, \#(vwx) \geq k$, and for all $i \geq 0, uv^iwx^iy \in A$

### Contrapositive Form

> If the above is true then $A$ is not a CFL - **Note** we pump on both $v$ and $x$

As before

- **Demon** picks $k \geq 0$
- **We** pick $z \in A$ of length at least $k$ 
- **Demon** picks $u, v, w, x, y$ such that $z = uvwxy, \#(vx) > 0$ and $\#(vwx) \leq k$
- **We** pick $i \geq 0$

**We** win if $uv^iwx^iy \notin A$ if the string is in $A$ then the **demon** wins

### Example

Consider $\{a^nb^nc^n \ | \ n \geq 0\}$

1. **Demon** picks some $k$
2. **We** pick $z = a^kb^kc^k$
3. **Demon** breaks the string up into $uvwxy$ where $\#(vx) > 0$ and $\#(vwx) \leq k$
4. **We** pick $i = 2$, now we need to think about $z' = uv^2wx^2y$

> We have to consider all the possible choices that the demon could have made in *step 3*

![Screenshot 2018-11-05 at 10.53.40](/Users/jackcorbett/Documents/University/Theory of Computing/Part 1/Images/Pumping Lemma for CFLs Example.png)

- If $vx$ contains only $a$'s, only $b$'s or only $c$'s then $z'$ is not of the form $a^kb^kc^k$ (as it will have too many of either $a$, $b$ or $c$)
- If either $v$ or $x$ contains two different symbols then $z' = uv^2wx^2y$ is not of the form $a^*b^*c^*$
- If $v$ contains only $a$'s and $x$ contains only $b$'s then $z'$ will not have enough $c$'s
- If $v$ contains only $b$'s and $x$ contains only $c$'s then $z'$ will not have enough $a$'s

>  In the example we picked $i$ without first considering the demon's choice of substrings $uvwxy$ 
>
> $i= 2$ worked for all his possible choices...
>
> In general we have the power to pick $i$ **after** knowing the demon's choice. 

## Intersection and Complement

- CFLs are **not** closed under intersection

Consider $A_1 \overset{def}{=} \{ a^nb^nc^m \ | \ n, m \geq 0\}$ and $A_2 \overset{def}{=} \{ a^nb^mc^m \ | \ n, m \geq 0\}$ which are both CFLs

Then $A_1 \cap A_2 = \{a^nb^nc^n \ | \ n \geq 0\}$ which is **not** a CFL 



- CFLs are **not** closed under complement

Consider $L = \{a^ib^jc^k \ | \ i \neq j \ or \ j \neq k \}$  it's simple to build a CFG for L

Suppose its complement $L' = \{a, b, c\} ^* - L$ is context free

- Then $L' \cap L(a^*b^*c^*)$ would be context free (as context free languages are closed under intersection with regular languages) **however** this languages is just $\{a^nb^nc^n \ | \ n \geq 0\}$ which is **not regular**

